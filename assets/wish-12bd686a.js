import{r as E,z as K,o as y,c as C,e as i,n as D,C as R,d as B,a as h,t as q,w as Q,_ as F,g as T,b as m,u as b,f as Z,j as c,F as k,i as z,k as j,l as V,q as J,D as S,E as Y,G as $,H as ee,B as te,v as x,A as se,x as ae,y as ie}from"./style-4c73e186.js";const ne="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAACXBIWXMAACE4AAAhOAFFljFgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAfmSURBVHgB7Z1NbFNHEIBnnl3sNmlIRQOoAuLQY4Emak/0QKhUKeFCeqvEgXBpL5UgVVEvlSBSb6ii9NYTQWolboQLidRKhEPLqcJCcAS/QFVBANWJiHDSvN3urO00/t9nv+e3a+8ngY29ifHM7szs7O4sgqZkJlL98VxumOHGMAAOImCKA08Bx35A3g8c+kt+ACEr3ssicBcQs5wegS86PJ7eSCbTQ7NuFjQEQRNI4LFcbgLAO8IBR4GEHSQIaeSQFs9ueRBbGJp/4oIGRKoAErqz9nISOR7nAKPQRsQXXxAPV6JWRiQKeDy2e5SDd67dQq8FIs6Khyv75pZmoc20TQHF3i7s9GnxzxToiSsEMr1v/tkMtIm2KODxsYHTjMP5CsepL21TRKgKIFPDwLsM+vb4RoSuiFAUkBnbnYrhxkXOcQI6ACGkGeGsp8Nw1oEr4K+xgZMewg8GmRtVQhkNgSlAxvFrq+c4hzPQwaDoXF6iZzqoiV0gCiCT44B3E8y19X5xGcSOBmGSHGiRzLGBYQe9O9A9widkh6PvDi3SkgLI3jsM7nSgvVchRd+dZAAt0LQCKLb3RHQAXQ7JYHF8V9N+rykfICdWTEQ6lv9BZ2pw7qlvmfhWgAwzbc+vSgxgcs/8syt+fsaXAqTDJZtvqQlzYGToxrO0antlHyBDTQbXwFIXh8NNkpVye5VGMpPZXXF+84iIUIaoQmYqzZUUQDNcsML3Q6ogs4Y09AGZsYFJoaXLYPGNilOuq4AuTDEEC0KW8dhIvZRFXRMkhG9NTysIfxBDdrFek5ojwJqe4GDAReLu+UK192qOAPGGkhOxNMYBvFz7vSpQ7wdreoIkVStf5NR40fb+wGHnqs0NKhRge39I0ARt7dVk+cvx8hd06v09n3wGyYOH67Zhqyvwz0/fghFwRnuiSjKmJVHQo/EdE5w72uR7dnz1o1RCPTaePoa/Jz8AUyiPiMpMELa0uhM0sV37oNOIAZZYmE0F0KxXt308Tm9fwzZsdRlMgvbDbnXGW0aANwqaEd+1t2Eb9nIFTGOrM95UgEgcaWV+4sL8OD3bG7bznj4C00DOjhefSwVI86PJVvEiiUOHldqREzaNrWaoMAL0Mz+Jg2oKWH94H0wklluV/tYp/HUENILMT2+D8LOIt2SeCSogZZ4fAQgt7/AKEnXz8wjWH9wDEymafCcz0U8nDrVRAPX+7SfOKrVdu/sHGExKrrXHc0mten/fia+Vwk8iZ7YCxBd4Oezkz+HqAfV8VdtP5mf1t6tgMg7GhkUyDlOgAW998R28OfG5cnvDzU8Blooj8EEe4XHh5KGPhNk5Kx7VHC9B6YflXy6A8XBMxeXR/whoRvBFaIb8zsyfEDahZ1oRBuO8DYsvlFKO79wL2NMH2949KP4cEEJsnGjreDjvjwstUBgaKpTXt1QBaRtjd55u0QO5j9QSKVYBEWMVEDGOrDRliQYhe3LCVgFRIWQfz9dag1BZ+uZTOXmKiSRbfOceeE3MBZqZgBWhmXA71oLDXm0T+QeXUhGuSEWEmpDL3f294jXKeCbEbHi7zH76236y/uC+UKr5hViE3Jcd8dciRAD1rtVfr4qp/oe+8zo0eiiVYTzIXREFUXnHaFn++QI8+fJjmWJWpU9x0UZvHNdh+VKOkUNLi+QrVDdadcIoYNxLO5Dc0EIBBJmlF9+fVm6vunNCW5K9aWdoNkthqAua8Or2DeWlxtcPj4OxIMpqvoWZMN4CjVhRdMrb9h9Q2j2nI8i5tDxSAQz4AmgEha2qo4DWFgxFdvr8CEj+2/aKsY14dXtOqd1r+98DE6GSyfQoFUB+oFBLWRvWqkzeqkFmyDRI1sXD25vZUI78OmjE+sN7SiGpyhkCDdksX7CpAJbYmAHNUMn3mHiKpmh+iE0F6GiGVJJh5kVBeH1r7YiSBRkP+DRohImHLxqBWFrureSYKp3eWxzb6QZ+e0WTeKsrDUeBWQc00C2/o6BiS9zi+NtnhEe+CJbAEcI+VV57umJNWDpju0wZAqL3Vyn8XaEAcsZMM1/QCWANmdbclSt8QUYXX2A+6A7OLw1Ve6fmthQG7BRYAgHrWJSaCqCICJFrlyMyDbp9o96lD3U3Znk8PmUdciugS1ef1GtRVwE0YxNLllNgaQoyPY0ueWi4NXGIhg+yS2DxBUO4pHLfjNLeUJbwztNwAosiQlaJnvMqLZUUkJ8bOEetP1ABXZKV6iU/tnx9wIRWvp6gX8xEPgMsVaG5kx/hE77PB5BTZshtZFQGyWRo/sUM+KTpA8IZkTV1bNZUIoU/97ypO3VaOqFt60sXzE4TPb9Iy0fk844Zr3Vd4o5K0yMc9WvzK39NAOTvGWA3u0cJhVBTh6sMCZmySK6PdMOMmWa4LPnGSFBX2wZepSPvF6g4aYeNBnkbBptqxd5XI/BjqjJMFcOTbdl8ZDqUls9fRRKs8OXvhhAxfzSQracop/rtF4F8ArQB4xRB5oZSyU3G9v4+qo3orwiRxRSBBEv0zgR1Y3bDT4QIyIzvmIgBntSlWDhtyfTk4kl4pqbOZ0dH/s5Fb5TqVre7dDIJnXaEt7O31/h/6EFRGeLpqIPwfvC1TNEVS4Sip8MtSPbMRin0rWijgHJkcWuqq4kwzABTMeCDVN+Oi+eAvL+i0JQsuYBZ8V6WTv97gIuOeJTHcJO9aV0EXs5/aioRVjkbt3IAAAAASUVORK5CYII=",le=()=>E({url:"/api/wish/list",method:"get"}),oe=e=>E({url:"/api/wish/vote",method:"post",data:{id:e}}),re=()=>E({url:"/api/wish/barrage",method:"get"}),ce=e=>E({url:"/api/wish/addWish",method:"post",data:{content:e}});const he={props:{arr:{type:Array,default:function(){return[]}},isPause:{type:Boolean},percent:{type:Number,default:80}},data(){return{MAX_DM_COUNT:5,CHANNEL_COUNT:8,barrages:this.arr,domPool:[],intervalDM:null,interValTime:500,hasPosition:[],hasTopPosition:[],barrageMainDm:null,barMainWidth:500,dmStyles:["color","fontSize"]}},computed:{},created(){},mounted(){this.barrageMainDm=this.$refs.barrageMainDm,this.barMainWidth=this.barrageMainDm.clientWidth,this.init(),this.playDm(),document.addEventListener("visibilitychange",this.visibilitychangeFn)},watch:{arr:{handler(e){this.barrages=e},immediate:!0},isPause(e){e?this.pauseDm():this.playDm()},percent(e){this.CHANNEL_COUNT=e/10}},methods:{visibilitychangeFn(){document.hidden?(clearInterval(this.intervalDM),this.intervalDM=null):this.playDm()},init(){this.$refs.barrageMainDm;for(let e=0;e<this.CHANNEL_COUNT;e++){let n=[];for(let t=0;t<this.MAX_DM_COUNT;t++){let s=document.createElement("div");s.className="barrage-item",s.style.transform=`translate3d(${this.barMainWidth}px,0,0)`,s.style.top=e*(this.barrageMainDm.clientHeight/this.CHANNEL_COUNT)+"px",s.addEventListener("animationend",r=>{s.className="barrage-item",s.style.transform=`translate3d(${this.barMainWidth}px,0,0)`,s.style.animation=null,this.dmStyles.forEach(u=>{s.style[u]=null}),this.domPool[t][e]&&(this.domPool[t][e].isFree=!1)}),n.push({row:e,col:t,el:s,isUse:!1,isFree:!1})}this.domPool.push(n)}for(let e=0;e<this.CHANNEL_COUNT;e++)this.hasPosition[e]=!0,this.hasTopPosition[e]=!0},getChannel(){for(let e=0;e<this.CHANNEL_COUNT;e++)if(this.hasPosition[e]&&this.domPool[e].length)return e;return-1},getTopChannel(){for(let e=0;e<this.CHANNEL_COUNT;e++)if(this.hasTopPosition[e])return e;return-1},shootDanmu(e,n,t){this.hasPosition[t]=!1;let s=e.el;if(!e.isUse&&this.barrageMainDm&&(e.isUse=!0,this.barrageMainDm.appendChild(e.el)),n.style){let r=Object.keys(n.style),u=this;r.forEach(f=>{u.dmStyles.includes(f)&&(s.style[f]=n.style[f])})}e.isFree=!0,n.isJs?s.innerHTML=n.content:s.innerText=n.content,s.className=n.isSelf?"barrage-item self-dm":"barrage-item",s.style.animation="barrage-run 5s linear",setTimeout(()=>{this.hasPosition[t]=!0},s.clientWidth*10+1e3)},shootTopDanmu(e,n){this.hasTopPosition[n]=!1;let t=document.createElement("div");if(t.className=e.isSelf?"barrage-item top-item self-dm":"barrage-item top-item",e.style){let s=Object.keys(e.style),r=this;s.forEach(u=>{r.dmStyles.includes(u)&&(t.style[u]=e.style[u])})}e.isJs?t.innerHTML=e.content:t.innerText=e.content,t.addEventListener("animationend",()=>{this.barrageMainDm.removeChild(t),this.hasTopPosition[n]=!0}),this.barrageMainDm.appendChild(t),t.style.transform=`translate3d(${this.barMainWidth/2-t.clientWidth/2}px,${n*t.clientHeight}px,0)`,t.style.animation="barrage-fade 3s"},getFreeChannelDom(e){let n;return n=this.domPool[e].find(t=>!t.isFree),n},pauseDm(){this.intervalDM&&(clearInterval(this.intervalDM),this.intervalDM=null)},playDm(){let e=this;e.intervalDM=setInterval(()=>{if(e.barrages.length>0){let n,t,s=e.barrages.shift();if(s.direction=="top"&&(t=e.getTopChannel())!=-1&&e.shootTopDanmu(s,t),s.direction=="default"&&(n=e.getChannel())!=-1){let r=e.getFreeChannelDom(n);r&&e.shootDanmu(r,s,n)}}},e.interValTime)}},components:{}},ue={class:"barrage-main"};function de(e,n,t,s,r,u){return y(),C("section",{class:"barrage-wrapper",ref:"barrageWrapper",style:R({height:t.percent+"%"})},[i("div",ue,[i("div",{class:D(["barrage-main-dm",{"ani-pause":t.isPause,"ani-running":!t.isPause}]),ref:"barrageMainDm"},null,2)])],4)}const fe=K(he,[["render",de]]),pe="/assets/save-image-133da993.png",ve={class:"wish-card"},ge=i("img",{style:{width:"70%"},src:pe,alt:"保存图片"},null,-1),me=[ge],_e=B({__name:"index",setup(e,{expose:n}){const t=h(),s=h(!1),r=h(""),u=h(""),f=h(),p=()=>{var v;s.value=!0,(v=t.value)==null||v.closeDialog(),setTimeout(()=>{s.value=!1},1e3)};return n({open:v=>{var M;const w=c(1,3);return r.value=T(`wish/bg_vote_0${w}.png`),u.value=T(`wish/title_${v}.png`),(M=t.value)==null?void 0:M.open()}}),(v,w)=>(y(),q(F,{ref_key:"popupRef",ref:t,onTouchMask:p},{default:Q(()=>[i("div",ve,[i("div",{class:D(["img-card",{leave:s.value}])},[m(b(Z),{ref_key:"wishPosterRef",ref:f,qrcordType:"join",title:u.value,background:r.value},null,8,["title","background"])],2),i("a",{class:D(["entry",{leave:s.value}]),href:"javascript:;"},me,2)])]),_:1},512))}});const Ae="/assets/clearance-55f7939f.png",be={class:"wish-card"},ye=i("img",{src:Ae},null,-1),De=[ye],we=i("div",{class:"lazy-image"},null,-1),Ce=B({__name:"index",setup(e,{expose:n}){const t=h(),s=h(!1),r=h(!1),u=()=>{var p;s.value=!0,(p=t.value)==null||p.closeDialog(),setTimeout(()=>{s.value=!1},1e3)};return n({open:()=>{var p;return r.value=!0,(p=t.value)==null?void 0:p.open()}}),(p,_)=>{const v=j("Vue3Lottie");return y(),C(k,null,[m(F,{ref_key:"popupRef",ref:t,onTouchMask:u},{default:Q(()=>[i("div",be,[i("div",{class:D(["img-card",{leave:s.value}])},De,2),m(v,{class:D(["fire",{top:r.value}]),animationData:b(z),loop:!1,onOnComplete:_[0]||(_[0]=w=>r.value=!1)},null,8,["class","animationData"])])]),_:1},512),we],64)}}});const Me={id:"container"},Ee=i("img",{src:ne,alt:"back"},null,-1),Ne=[Ee],Re={class:"wish-wall mode-1"},ke={class:"item-list"},Be=["onClick"],Oe={class:"wish-detail",href:"javascript:;"},Te={class:"name"},Ve={class:"percent"},Se={class:"footer"},xe={for:"barrage",class:"barrage-checkbox"},Qe={class:"checkbox"},Fe=i("span",{class:"check"},null,-1),Ue=i("span",null,"显示弹幕",-1),Le={class:"send-wish"},Pe={class:"wish-input"},We=["disabled"],He=B({__name:"App",setup(e){const n=h([]),t=h(!0),s=h([]),r=h(),u=h(),f=h(""),p=h(!1),_=h(),v=h(!1),w=async()=>{const l=await le();n.value=l.data,v.value=!0,re().then(o=>{let a=o.data||[];s.value=a.map(d=>({content:d.content,direction:"default"}))})},M=(l,o)=>{let a=[],d=!1;for(let A=o;A>0;A--)if(l>0){let g=A>0?c(d?2:1,Math.min(3,Math.ceil(l/A))):l;l<g&&(g=l),!d&&g==1&&(d=!0),a.push(g),l-=g}return l&&a.push(l),a},U=(l,o)=>{const a=()=>({delay:c(-3,3)+"s",duration:c(6,10)+"s",top:o*P+c(-250,180)/100+o*2.5+"%",rotate:Math.random()>.8});switch(l){case 1:return[{...a(),left:c(5,65)+"%",scale:c(85,115)/100}];case 2:let d=c(5,25);return[{...a(),left:d+"%",scale:c(75,110)/100},{...a(),left:c(d+33,65)+"%",scale:c(75,110)/100}];case 3:default:let A=c(0,3),g=c(A+35,38);return[{...a(),left:A+"%",scale:c(70,90)/100},{...a(),left:g+"%",scale:c(70,100)/100},{...a(),left:c(g+32,69)+"%",scale:c(70,86)/100}]}},N=15;let L=M(N,Math.floor(N/2)),P=90/Math.ceil(N/2),O=[];L.forEach((l,o)=>{U(l,o).forEach(d=>{O.push({...d})})});const W=V(()=>n.value.map((l,o)=>({...l,...O[o]}))),H=V(()=>t.value?[...s.value]:[]);w();const X=l=>{var o,a;oe(l).then(d=>{n.value=d.data.list}),(o=r.value)==null||o.open(l),(a=_.value)==null||a.get()},G=async()=>{var a,d;if(p.value)return!1;if(!f.value)return window.Qmsg.warning("先写点东西吧"),!1;p.value=!0;const l=await ce(f.value);p.value=!1;const o=f.value;f.value="",l.data.clearance?(d=u.value)==null||d.open():(window.Qmsg.success(l.msg),s.value.push({content:o,direction:"default"}),(a=_.value)==null||a.get())},I=()=>{ee()};return(l,o)=>(y(),C(k,null,[m(te),i("div",Me,[i("div",{class:"back"},[i("a",{href:"javascript:;",class:"go-back",onClick:I},Ne)]),i("div",Re,[i("div",ke,[(y(!0),C(k,null,J(b(W),a=>(y(),C("div",{class:"wish-item",key:a.id,style:R({top:a.top,left:a.left,transform:"scale("+a.scale+")"})},[i("div",{class:D(["wish-box",{rotate:a.rotate}]),onClick:d=>X(a.id)},[i("div",{class:"wish-move",style:R({animationDelay:a.delay,animationDuration:a.duration})},[i("a",Oe,[i("div",Te,x(a.name),1),i("div",Ve,x(a.percent)+"%",1)])],4)],10,Be)],4))),128))])]),i("div",Se,[i("label",xe,[i("div",Qe,[S(i("input",{type:"checkbox",id:"barrage","onUpdate:modelValue":o[0]||(o[0]=a=>t.value=a)},null,512),[[Y,t.value]]),Fe]),Ue]),i("div",Le,[i("div",Pe,[S(i("input",{type:"text",placeholder:"有别的祝福或发点其他？","onUpdate:modelValue":o[1]||(o[1]=a=>f.value=a)},null,512),[[$,f.value]])]),i("a",{href:"javascript:;",disabled:p.value,class:"send-btn",onClick:G}," 发送 ",8,We)])]),m(fe,{style:{"margin-top":"10%"},percent:75,arr:b(H),isPause:!1},null,8,["arr"]),m(b(_e),{ref_key:"wishCardRef",ref:r},null,512),m(b(Ce),{ref_key:"clearanceRef",ref:u},null,512),m(b(se),{ref_key:"achievementRef",ref:_,module:"wish"},null,512)])],64))}});ae(He).use(ie).mount("#app");
